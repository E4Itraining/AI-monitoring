# Victoria Metrics / vmagent Scrape Configuration
# Compatible with Prometheus scrape_configs format

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: ai-monitoring
    environment: production

scrape_configs:
  # ===========================================================================
  # AI Application Metrics
  # ===========================================================================
  - job_name: 'ai-app'
    metrics_path: /metrics
    scrape_interval: 5s  # More frequent for AI metrics
    static_configs:
      - targets: ['app:8000']
        labels:
          service: ai-monitoring-app
          tier: application

  # ===========================================================================
  # OpenTelemetry Collector Self-Metrics
  # ===========================================================================
  - job_name: 'otel-collector'
    metrics_path: /metrics
    static_configs:
      - targets: ['otel-collector:8888']
        labels:
          service: otel-collector
          tier: infrastructure

  # ===========================================================================
  # Victoria Metrics Self-Metrics
  # ===========================================================================
  - job_name: 'victoria-metrics'
    static_configs:
      - targets: ['victoria-metrics:8428']
        labels:
          service: victoria-metrics
          tier: infrastructure

  # ===========================================================================
  # Tempo Metrics
  # ===========================================================================
  - job_name: 'tempo'
    static_configs:
      - targets: ['tempo:3200']
        labels:
          service: tempo
          tier: infrastructure

  # ===========================================================================
  # Fluent-bit Metrics
  # ===========================================================================
  - job_name: 'fluent-bit'
    metrics_path: /api/v1/metrics/prometheus
    static_configs:
      - targets: ['fluent-bit:2020']
        labels:
          service: fluent-bit
          tier: infrastructure

  # ===========================================================================
  # OpenSearch Metrics (if available)
  # ===========================================================================
  - job_name: 'opensearch'
    metrics_path: /_prometheus/metrics
    scrape_interval: 30s
    static_configs:
      - targets: ['opensearch:9200']
        labels:
          service: opensearch
          tier: infrastructure
    # OpenSearch may not have prometheus exporter enabled by default
    honor_labels: true
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        regex: '(.+)'
        replacement: 'opensearch'

  # ===========================================================================
  # Grafana Metrics
  # ===========================================================================
  - job_name: 'grafana'
    static_configs:
      - targets: ['grafana:3000']
        labels:
          service: grafana
          tier: infrastructure
